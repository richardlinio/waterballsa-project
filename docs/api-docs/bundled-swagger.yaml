openapi: 3.0.3
info:
  title: WaterBall SA 後端 API
  description: |
    WaterBall SA 平台後端 API

    此 API 提供 WaterBall SA 學習平台的端點，包括健康檢查、
    旅程管理和使用者互動。
  version: 1.0.0
  contact:
    name: API 支援
    email: support@waterballsa.tw
servers:
  - url: 'http://localhost:8080'
    description: 開發伺服器
  - url: 'https://api.waterballsa.tw'
    description: 正式環境伺服器
tags:
  - name: Health Check
    description: API 健康監控端點
  - name: Auth
    description: 使用者認證與授權端點
  - name: Journeys
    description: 學習旅程管理端點
  - name: Missions
    description: 學習任務（影片/文章/問卷）管理端點
  - name: Progress
    description: 使用者任務進度追蹤端點
  - name: Users
    description: 使用者個人資料與資訊端點
  - name: Orders
    description: 課程購買訂單管理端點
  - name: User Journeys
    description: 使用者已購買旅程存取管理端點
paths:
  /healthz:
    get:
      tags:
        - Health Check
      summary: 健康檢查端點
      description: |
        回傳資料庫連線健康狀態。

        當資料庫健康時回傳 HTTP 200，當資料庫故障時回傳 HTTP 503。
      operationId: checkHealth
      responses:
        '200':
          description: 服務正常
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                healthy:
                  summary: 資料庫健康
                  value:
                    status: UP
                    database: UP
        '503':
          description: 服務無法使用
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                unhealthy:
                  summary: 資料庫連線失敗
                  value:
                    status: DOWN
                    database: DOWN
  /auth/register:
    post:
      tags:
        - Auth
      summary: 使用者註冊
      description: |
        使用帳號與密碼註冊新使用者。

        **速率限制：**
        - 每個 IP 每小時最多 5 次註冊
        - 超過速率限制時回傳 400 與通用錯誤訊息（避免資訊洩漏）

        **驗證規則：**
        - 使用者名稱和密碼必須為英數字元，允許特殊字元
        - 兩者都有長度限制
        - 初始經驗值設為 0
        - 成功後重新導向至登入頁面
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              valid:
                summary: 有效的註冊
                value:
                  username: john_doe123
                  password: SecurePass123!
      responses:
        '201':
          description: 使用者註冊成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
              examples:
                success:
                  summary: 註冊成功
                  value:
                    message: 註冊成功
                    userId: 1
        '400':
          description: 請求資料無效或超過速率限制
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidFormat:
                  summary: 使用者名稱或密碼格式無效
                  value:
                    error: 使用者名稱或密碼格式無效
                rateLimited:
                  summary: 超過速率限制（基於安全性的通用訊息）
                  value:
                    error: 註冊失敗。請稍後再試。
        '409':
          description: 使用者名稱已存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicate:
                  summary: 使用者名稱已被使用
                  value:
                    error: 使用者名稱已存在
  /auth/login:
    post:
      tags:
        - Auth
      summary: 使用者登入
      description: |
        使用帳號與密碼進行使用者身分驗證。

        **速率限制：**
        - 每個 IP 每 15 分鐘最多 5 次失敗嘗試
        - 超過速率限制時回傳 401（與無效憑證相同以避免資訊洩漏）

        **安全性：**
        - 回傳 JWT 存取權杖（1 天後過期）
        - 權杖應包含在受保護端點的 Authorization 標頭中
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              valid:
                summary: 有效的登入憑證
                value:
                  username: john_doe123
                  password: SecurePass123!
      responses:
        '200':
          description: 登入成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              examples:
                success:
                  summary: 登入成功
                  value:
                    accessToken: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    user:
                      id: 1
                      username: john_doe123
                      experience: 0
        '401':
          description: 憑證無效或超過速率限制
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid:
                  summary: 錯誤的使用者名稱或密碼
                  value:
                    error: 使用者名稱或密碼無效
                rateLimited:
                  summary: 超過速率限制（基於安全性使用相同錯誤訊息）
                  value:
                    error: 使用者名稱或密碼無效
  /auth/logout:
    post:
      tags:
        - Auth
      summary: 使用者登出
      description: |
        登出目前使用者並使存取權杖失效。

        **權杖失效化：**
        - 存取權杖會被加入黑名單（儲存在資料庫中）
        - 黑名單項目會在權杖過期時自動過期
        - 登出後，權杖無法用於存取受保護的端點

        **注意：** 需要在 Authorization 標頭中提供有效的存取權杖
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 登出成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogoutResponse'
              examples:
                success:
                  summary: 登出成功
                  value:
                    message: 登出成功
        '401':
          description: 未授權 - 權杖無效或遺失
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 權杖無效或遺失
                  value:
                    error: 未授權或權杖無效
  /journeys:
    get:
      tags:
        - Journeys
      summary: 取得旅程列表
      description: |
        回傳所有可用學習旅程的列表。

        **公開存取：**
        - 不需要身分驗證
        - 回傳旅程基本資訊，包括封面圖片、標題和描述

        **回應：**
        - 回傳所有未被軟刪除的旅程
        - 旅程按建立順序回傳（按時間順序）
      operationId: getJourneys
      responses:
        '200':
          description: 成功取得旅程列表
          content:
            application/json:
              schema:
                type: object
                required:
                  - journeys
                properties:
                  journeys:
                    type: array
                    items:
                      $ref: '#/components/schemas/JourneyListItem'
              examples:
                success:
                  summary: 包含多個旅程的旅程列表
                  value:
                    journeys:
                      - id: 1
                        slug: design-patterns-mastery
                        title: 軟體設計模式精通之旅
                        description: 用 C.A. 模式大大提昇系統思維能力
                        coverImageUrl: 'https://example.com/cover1.jpg'
                        teacherName: 水球潘
                        price: 3990
                      - id: 2
                        slug: web-development-intro
                        title: Web 開發入門
                        description: 從零開始學習網頁開發
                        coverImageUrl: 'https://example.com/cover2.jpg'
                        teacherName: 林老師
                        price: 2990
  '/journeys/{journeyId}':
    get:
      tags:
        - Journeys
      summary: 取得旅程詳情
      description: |
        回傳特定旅程的詳細資訊，包括所有章節和任務。

        **公開存取：**
        - 不需要身分驗證
        - 任何人都可以查看旅程結構和任務標題

        **身分驗證（選填）：**
        - 如果提供 JWT 權杖，回應會包含已驗證使用者的任務狀態
        - 任務狀態顯示進度：UNCOMPLETED、COMPLETED 或 DELIVERED
        - 沒有身分驗證時，狀態欄位將為 null

        **回應結構：**
        - 旅程基本資訊
        - 章節列表及其任務
        - 每個任務包括：id、類型、標題、存取等級和狀態（如果已驗證）
        - 此端點不包含任務詳情（影片網址、時長、內容）（請使用任務詳情端點）

        **注意：**
        - 章節和任務按 order_index 排序
        - 任務存取等級：PUBLIC（任何人可查看）、AUTHENTICATED（需要登入）、PURCHASED（需要購買旅程）
        - 任務狀態從 user_mission_progress 資料表取得（如果沒有進度記錄則預設為 UNCOMPLETED）
      operationId: getJourneyDetail
      security:
        - bearerAuth: []
        - {}
      parameters:
        - name: journeyId
          in: path
          required: true
          description: 旅程 ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: 成功取得旅程詳情
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JourneyDetail'
              examples:
                authenticated:
                  summary: 包含章節和任務的旅程（已驗證使用者）
                  value:
                    id: 1
                    slug: design-patterns-mastery
                    title: 軟體設計模式精通之旅
                    description: 用 C.A. 模式大大提昇系統思維能力
                    coverImageUrl: 'https://example.com/cover1.jpg'
                    teacherName: 水球潘
                    price: 3990
                    chapters:
                      - id: 1
                        title: 課程介紹
                        orderIndex: 1
                        missions:
                          - id: 1
                            type: VIDEO
                            title: 這門課手把手帶你成為架構設計的高手
                            accessLevel: PUBLIC
                            orderIndex: 1
                            status: DELIVERED
                          - id: 2
                            type: VIDEO
                            title: 你該知道：在 AI 的時代下，只會下 prompt 絕對寫不出好 Code
                            accessLevel: PUBLIC
                            orderIndex: 2
                            status: COMPLETED
                      - id: 2
                        title: 架構思維的 C.A. 模式
                        orderIndex: 2
                        missions:
                          - id: 3
                            type: VIDEO
                            title: 架構師該如何思考
                            accessLevel: PURCHASED
                            orderIndex: 1
                            status: UNCOMPLETED
                unauthenticated:
                  summary: 包含章節和任務的旅程（未驗證）
                  value:
                    id: 1
                    slug: design-patterns-mastery
                    title: 軟體設計模式精通之旅
                    description: 用 C.A. 模式大大提昇系統思維能力
                    coverImageUrl: 'https://example.com/cover1.jpg'
                    teacherName: 水球潘
                    price: 3990
                    chapters:
                      - id: 1
                        title: 課程介紹
                        orderIndex: 1
                        missions:
                          - id: 1
                            type: VIDEO
                            title: 這門課手把手帶你成為架構設計的高手
                            accessLevel: PUBLIC
                            orderIndex: 1
                            status: null
                          - id: 2
                            type: VIDEO
                            title: 你該知道：在 AI 的時代下，只會下 prompt 絕對寫不出好 Code
                            accessLevel: PUBLIC
                            orderIndex: 2
                            status: null
                      - id: 2
                        title: 架構思維的 C.A. 模式
                        orderIndex: 2
                        missions:
                          - id: 3
                            type: VIDEO
                            title: 架構師該如何思考
                            accessLevel: PURCHASED
                            orderIndex: 1
                            status: null
        '404':
          description: 找不到旅程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 旅程不存在
                  value:
                    error: 找不到旅程
  '/journeys/{journeyId}/missions/{missionId}':
    get:
      tags:
        - Missions
      summary: 取得任務詳細資訊
      description: |
        回傳特定任務的詳細資訊，包括內容和獎勵。

        **注意：** 此端點不包含使用者進度。請使用 GET /users/{userId}/missions/{missionId}/progress 來取得進度資訊。

        **認證：**
        - 需要有效的 JWT token

        **回應包含：**
        - 任務基本資訊（id、chapterId、journeyId、type、title、description）
        - 資源陣列（可包含多個資源項目，如影片、文章、表單）
        - 獎勵資訊（經驗值）
        - 存取層級
        - 建立時間戳記

        **資源結構：**
        - 每個任務可以有多個資源項目
        - 資源類型：video、article、form
        - 影片包含 durationSeconds 欄位

        **存取層級：**
        - PUBLIC: 所有使用者都可以存取
        - AUTHENTICATED: 需要登入才能存取
        - PURCHASED: 需要購買旅程才能存取
      operationId: getMissionDetail
      security:
        - bearerAuth: []
      parameters:
        - name: journeyId
          in: path
          required: true
          description: 旅程 ID
          schema:
            type: integer
            example: 1
        - name: missionId
          in: path
          required: true
          description: 任務 ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: 成功取得任務詳細資訊
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionDetail'
              examples:
                videoMission:
                  summary: 影片任務範例
                  value:
                    id: 1
                    chapterId: 8
                    journeyId: 1
                    type: VIDEO
                    title: 課程介紹：這門課手把手帶你成為架構設計的高手
                    description: 思維升級：Christopher Alexander 模式六大要素及模式語言
                    accessLevel: PUBLIC
                    createdAt: 1733294001561
                    videoLength: '04:16'
                    reward:
                      exp: 100
                    resource:
                      - id: 0
                        type: video
                        resourceUrl: 'https://cdn.waterballsa.tw/software-design-pattern/videos/c8m1-0/c8m1-0.m3u8'
                        durationSeconds: 256
                articleMission:
                  summary: 文章任務範例
                  value:
                    id: 5
                    chapterId: 10
                    journeyId: 1
                    type: ARTICLE
                    title: UML 不是英文縮寫字
                    description: UML 統一塑模語言完整介紹
                    accessLevel: PURCHASED
                    createdAt: 1733294001561
                    reward:
                      exp: 100
                    resource:
                      - id: 0
                        type: article
                        resourceUrl: 'https://cdn.waterballsa.tw/articles/uml-intro.html'
                questionnaireMission:
                  summary: 問卷任務範例
                  value:
                    id: 7
                    chapterId: 12
                    journeyId: 1
                    type: QUESTIONNAIRE
                    title: 課程回饋問卷
                    description: 請填寫課程回饋問卷，幫助我們改進課程內容
                    accessLevel: AUTHENTICATED
                    createdAt: 1733294001561
                    reward:
                      exp: 50
                    resource:
                      - id: 0
                        type: form
                        resourceUrl: 'https://forms.waterballsa.tw/feedback-form-1'
        '401':
          description: 未授權 - 無效或遺失的 token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 無效或遺失的 token
                  value:
                    error: 未授權或無效的 token
        '404':
          description: 找不到任務
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 任務不存在
                  value:
                    error: 找不到任務
  '/users/{userId}/missions/{missionId}/progress':
    get:
      tags:
        - Progress
      summary: 取得使用者的任務進度
      description: |
        回傳使用者特定任務的進度。

        **認證：**
        - 需要有效的 JWT token

        **回應包含：**
        - 任務 ID
        - 目前狀態（UNCOMPLETED、COMPLETED、DELIVERED）
        - 觀看位置（秒數）（針對影片任務）

        **狀態含義：**
        - UNCOMPLETED：任務進行中或尚未開始
        - COMPLETED：任務已完成但尚未交付
        - DELIVERED：任務已交付且獎勵已領取

        **注意：**
        - 對於沒有進度記錄的任務，回傳預設的 UNCOMPLETED 狀態，watchPositionSeconds 為 0
      operationId: getUserMissionProgress
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: 使用者 ID
          schema:
            type: integer
            example: 1
        - name: missionId
          in: path
          required: true
          description: 任務 ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: 成功取得任務進度
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserMissionProgressResponse'
              examples:
                videoNotStarted:
                  summary: 影片任務尚未開始
                  value:
                    missionId: 1
                    status: UNCOMPLETED
                    watchPositionSeconds: 0
                videoInProgress:
                  summary: 影片任務進行中
                  value:
                    missionId: 1
                    status: UNCOMPLETED
                    watchPositionSeconds: 150
                videoCompleted:
                  summary: 影片任務已完成但尚未交付
                  value:
                    missionId: 1
                    status: COMPLETED
                    watchPositionSeconds: 256
                missionDelivered:
                  summary: 任務已交付
                  value:
                    missionId: 1
                    status: DELIVERED
                    watchPositionSeconds: 256
        '401':
          description: 未授權 - 無效或遺失的 token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 無效或遺失的 token
                  value:
                    error: 未授權或無效的 token
        '403':
          description: 禁止 - 無法存取其他使用者的進度
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                forbidden:
                  summary: 無法存取其他使用者的進度
                  value:
                    error: 無法存取其他使用者的進度
        '404':
          description: 找不到任務
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 任務不存在
                  value:
                    error: 找不到任務
    put:
      tags:
        - Progress
      summary: 更新使用者的任務進度
      description: |
        更新使用者特定任務的進度（upsert 操作 - 不存在則建立）。

        **認證：**
        - 需要有效的 JWT token
        - 使用者只能更新自己的進度

        **進度追蹤：**
        - 針對影片任務：
          - 前端在影片播放期間每 10 秒呼叫此 API
          - 傳送 watchPositionSeconds 來更新進度
          - 後端自動檢查 watchPositionSeconds == durationSeconds
          - 當相等時，任務狀態變為「COMPLETED」但不是「DELIVERED」
          - 進度可以多次更新（用於重新觀看）

        - 針對文章和問卷任務：
          - 不需要進度追蹤
          - 使用者直接交付任務以標記為完成

        **狀態轉換：**
        - UNCOMPLETED → COMPLETED：當影片播放到結尾時（watchPositionSeconds == durationSeconds）
        - 使用者必須手動交付（透過 deliver 端點）以獲得經驗值並變更為 DELIVERED 狀態

        **Upsert 行為：**
        - 如果進度記錄不存在，建立新記錄並使用提供的 watchPositionSeconds
        - 如果進度記錄存在，更新 watchPositionSeconds

        **注意：**
        - 此端點不授予經驗值
        - 經驗值僅透過 deliver 端點授予
      operationId: updateUserMissionProgress
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: 使用者 ID
          schema:
            type: integer
            example: 1
        - name: missionId
          in: path
          required: true
          description: 任務 ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProgressRequest'
            examples:
              videoInProgress:
                summary: 更新影片進度至 150 秒
                value:
                  watchPositionSeconds: 150
              videoCompleted:
                summary: 更新影片進度至完成（256 秒）
                value:
                  watchPositionSeconds: 256
      responses:
        '200':
          description: 進度更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserMissionProgressResponse'
              examples:
                videoInProgress:
                  summary: 影片進度已更新（狀態：UNCOMPLETED）
                  value:
                    missionId: 1
                    watchPositionSeconds: 150
                    status: UNCOMPLETED
                videoCompleted:
                  summary: 影片進度已更新（狀態：COMPLETED）
                  value:
                    missionId: 1
                    watchPositionSeconds: 256
                    status: COMPLETED
        '400':
          description: 無效的請求資料
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidProgress:
                  summary: 無效的觀看位置
                  value:
                    error: 無效的觀看位置：必須介於 0 和影片長度之間
        '401':
          description: 未授權 - 無效或遺失的 token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 無效或遺失的 token
                  value:
                    error: 未授權或無效的 token
        '403':
          description: 禁止 - 無法更新其他使用者的進度
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                forbidden:
                  summary: 無法更新其他使用者的進度
                  value:
                    error: 無法更新其他使用者的進度
        '404':
          description: 找不到任務
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 任務不存在
                  value:
                    error: 找不到任務
  '/users/{userId}/missions/{missionId}/progress/deliver':
    post:
      tags:
        - Progress
      summary: 交付任務以獲得經驗值
      description: |
        交付已完成的任務以獲得經驗值並將狀態變更為 DELIVERED。

        **認證：**
        - 需要有效的 JWT token
        - 使用者只能交付自己的進度

        **要求：**
        - 針對影片任務：必須具有 COMPLETED 狀態（已觀看至結尾）
        - 針對文章/問卷任務：可以直接交付（無需進度追蹤）
        - 如果任務狀態已經是 DELIVERED 則無法交付
        - 每個任務只能交付一次

        **效果：**
        - 將進度狀態從 COMPLETED（或非影片任務的 UNCOMPLETED）變更為 DELIVERED
        - 將經驗值新增至使用者（數量定義於任務獎勵中）
        - 根據新的經驗值更新使用者等級

        **等級計算：**
        - 等級 1：0-199 XP
        - 等級 2：200-499 XP
        - 等級 3：500-1499 XP
        - 等級 4：1500-2999 XP
        - 等級 5：3000-4999 XP
        - 等級 6：5000-6999 XP
        - 等級 7+：每級 +2000 XP
        - 等級 36（最高）：65000+ XP

        **注意：**
        - 經驗值每個任務僅授予一次
        - 重複交付回傳 409 Conflict
      operationId: deliverMission
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: 使用者 ID
          schema:
            type: integer
            example: 1
        - name: missionId
          in: path
          required: true
          description: 任務 ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: 任務交付成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeliverResponse'
              examples:
                success:
                  summary: 成功交付並獲得經驗值
                  value:
                    message: 任務交付成功
                    experienceGained: 100
                    totalExperience: 1500
                    currentLevel: 4
                levelUp:
                  summary: 交付並升級
                  value:
                    message: 任務交付成功
                    experienceGained: 100
                    totalExperience: 3000
                    currentLevel: 5
        '400':
          description: 任務未完成或狀態無效
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                videoNotCompleted:
                  summary: 無法交付未完成的影片任務
                  value:
                    error: 影片任務必須為 COMPLETED 狀態才能交付
        '401':
          description: 未授權 - 無效或遺失的 token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 無效或遺失的 token
                  value:
                    error: 未授權或無效的 token
        '403':
          description: 禁止 - 無法交付其他使用者的進度
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                forbidden:
                  summary: 無法交付其他使用者的進度
                  value:
                    error: 無法交付其他使用者的進度
        '404':
          description: 找不到任務
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 任務不存在
                  value:
                    error: 找不到任務
        '409':
          description: 任務已交付
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicate:
                  summary: 無法交付兩次
                  value:
                    error: 任務已經交付過了
  /users/me:
    get:
      tags:
        - Users
      summary: 取得目前使用者的個人資料
      description: |
        回傳目前已認證使用者的個人資料資訊。

        **認證：**
        - 需要有效的 JWT token

        **回應包含：**
        - 使用者 ID
        - 使用者名稱
        - 經驗值（累計總數）
        - 目前等級（從經驗值計算）
        - 使用者角色（STUDENT、TEACHER、ADMIN）

        **等級資訊：**
        - 等級根據總經驗值計算
        - 最高等級為 36（需要 65000+ XP）
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 成功取得使用者個人資料
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
              examples:
                student:
                  summary: 學生使用者個人資料
                  value:
                    id: 1
                    username: john_doe123
                    experiencePoints: 1500
                    level: 4
                    role: STUDENT
                highLevel:
                  summary: 高等級學生
                  value:
                    id: 2
                    username: advanced_learner
                    experiencePoints: 15000
                    level: 11
                    role: STUDENT
        '401':
          description: 未授權 - 無效或遺失的 token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 無效或遺失的 token
                  value:
                    error: 未授權或無效的 token
        '404':
          description: 找不到 - 找不到使用者個人資料
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 找不到使用者
                  value:
                    error: 找不到使用者
  /orders:
    post:
      tags:
        - Orders
      summary: 建立訂單
      description: |
        為旅程購買建立新訂單。

        **需要認證：**
        - 使用者必須已登入才能建立訂單

        **業務邏輯：**
        - 一個訂單只能包含一個旅程（MVP 範圍）
        - 如果使用者已購買該旅程：回傳 409 Conflict
        - 如果使用者已有該旅程的未付款訂單：回傳現有訂單（200 OK）
        - 訂單編號格式：`{timestamp}{userId}{randomCode}`
          - 範例：`20251121011117cd5` = `2025112101`（時間戳記）+ `11`（userId）+ `17cd5`（隨機碼）
        - 旅程價格在訂單建立時鎖定（來自 journeys.price）
        - 訂單狀態預設為 UNPAID
        - 訂單到期時間設定為 created_at + 3 天
        - 如果 3 天內未付款，訂單自動過期（狀態變更為 EXPIRED）

        **後續步驟：**
        - 前端應重新導向至訂單付款頁面
        - 使用者可透過 POST /orders/{orderId}/pay 完成付款
      operationId: createOrder
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
            examples:
              create:
                summary: 為旅程建立訂單
                value:
                  items:
                    - journeyId: 17
                      quantity: 1
      responses:
        '200':
          description: 使用者已有該旅程的未付款訂單，回傳現有訂單
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
              examples:
                existing:
                  summary: 回傳現有未付款訂單
                  value:
                    id: 120
                    orderNumber: 20251120011117a8f
                    userId: 11
                    username: john_doe
                    status: UNPAID
                    originalPrice: 7599
                    discount: 0
                    price: 7599
                    items:
                      - journeyId: 17
                        journeyTitle: AI x BDD：規格驅動全自動開發術
                        quantity: 1
                        originalPrice: 7599
                        discount: 0
                        price: 7599
                    createdAt: 1732334400000
                    expiredAt: 1732593600000
                    paidAt: null
        '201':
          description: 訂單建立成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
              examples:
                created:
                  summary: 新訂單已建立
                  value:
                    id: 123
                    orderNumber: 20251121011117cd5
                    userId: 11
                    username: john_doe
                    status: UNPAID
                    originalPrice: 7599
                    discount: 0
                    price: 7599
                    items:
                      - journeyId: 17
                        journeyTitle: AI x BDD：規格驅動全自動開發術
                        quantity: 1
                        originalPrice: 7599
                        discount: 0
                        price: 7599
                    createdAt: 1732420800000
                    expiredAt: 1732680000000
                    paidAt: null
        '400':
          description: 錯誤的請求 - 無效的旅程 ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidJourney:
                  summary: 無效的旅程 ID
                  value:
                    error: 無效的旅程 ID
        '401':
          description: 未授權 - 使用者未登入
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 使用者未認證
                  value:
                    error: 需要身份驗證
        '404':
          description: 找不到旅程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 旅程不存在
                  value:
                    error: 找不到旅程
        '409':
          description: 衝突 - 使用者已購買此旅程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                alreadyPurchased:
                  summary: 使用者已擁有此旅程
                  value:
                    error: 你已經購買此課程
  '/orders/{orderId}':
    get:
      tags:
        - Orders
      summary: 取得訂單詳細資訊
      description: |
        回傳特定訂單的詳細資訊。

        **需要認證：**
        - 使用者必須已登入
        - 使用者只能查看自己的訂單（嘗試存取其他使用者的訂單會回傳 404）

        **使用案例：**
        - 在付款頁面顯示訂單資訊（「完成支付」階段）
        - 付款後顯示訂單確認（「購買完成」階段）
        - 查看訂單歷史記錄

        **回應：**
        - 訂單基本資訊（訂單編號、狀態、價格）
        - 訂單項目（旅程資訊）
        - 時間戳記（created_at、paid_at（如適用））
      operationId: getOrderDetail
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          description: 訂單 ID
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: 成功取得訂單詳細資訊
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
              examples:
                unpaid:
                  summary: 未付款訂單
                  value:
                    id: 123
                    orderNumber: 20251121011117cd5
                    userId: 11
                    username: john_doe
                    status: UNPAID
                    originalPrice: 7599
                    discount: 0
                    price: 7599
                    items:
                      - journeyId: 17
                        journeyTitle: AI x BDD：規格驅動全自動開發術
                        quantity: 1
                        originalPrice: 7599
                        discount: 0
                        price: 7599
                    createdAt: 1732420800000
                    expiredAt: 1732680000000
                    paidAt: null
                paid:
                  summary: 已付款訂單
                  value:
                    id: 123
                    orderNumber: 20251121011117cd5
                    userId: 11
                    username: john_doe
                    status: PAID
                    originalPrice: 7599
                    discount: 0
                    price: 7599
                    items:
                      - journeyId: 17
                        journeyTitle: AI x BDD：規格驅動全自動開發術
                        quantity: 1
                        originalPrice: 7599
                        discount: 0
                        price: 7599
                    createdAt: 1732420800000
                    expiredAt: null
                    paidAt: 1732507200000
                expired:
                  summary: 已過期訂單
                  value:
                    id: 124
                    orderNumber: 20251118011117xyz
                    userId: 11
                    username: john_doe
                    status: EXPIRED
                    originalPrice: 7599
                    discount: 0
                    price: 7599
                    items:
                      - journeyId: 17
                        journeyTitle: AI x BDD：規格驅動全自動開發術
                        quantity: 1
                        originalPrice: 7599
                        discount: 0
                        price: 7599
                    createdAt: 1732161600000
                    expiredAt: 1732420800000
                    paidAt: null
        '401':
          description: 未授權 - 使用者未登入
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 使用者未認證
                  value:
                    error: 需要身份驗證
        '404':
          description: 找不到訂單或使用者沒有查看此訂單的權限
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 訂單不存在或存取被拒絕
                  value:
                    error: 找不到訂單
  '/orders/{orderId}/action/pay':
    post:
      tags:
        - Orders
      summary: 完成訂單付款
      description: |
        完成訂單付款並授予使用者旅程存取權。

        **需要認證：**
        - 使用者必須已登入
        - 使用者只能支付自己的訂單

        **業務邏輯：**
        - 訂單狀態必須為 UNPAID（已過期的訂單無法付款）
        - 付款成功後：
          - 訂單狀態變更為 PAID
          - 設定 paid_at 時間戳記
          - 使用者獲得旅程存取權（在 user_journeys 表中建立記錄）
        - 付款為模擬（MVP 中沒有整合實際的付款閘道）

        **注意：**
        - 在 MVP 中，點擊「立即支付」按鈕會自動完成購買
        - 實際的付款整合可在未來版本中加入
      operationId: payOrder
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          description: 訂單 ID
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: 付款完成成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PayOrderResponse'
              examples:
                success:
                  summary: 付款成功
                  value:
                    id: 123
                    orderNumber: 20251121011117cd5
                    status: PAID
                    price: 7599
                    paidAt: 1732507200000
                    message: 付款完成
        '401':
          description: 未授權 - 使用者未登入
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 使用者未認證
                  value:
                    error: 需要身份驗證
        '404':
          description: 找不到訂單或使用者沒有權限
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 訂單不存在或存取被拒絕
                  value:
                    error: 找不到訂單
        '409':
          description: 衝突 - 訂單已付款或已過期
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                alreadyPaid:
                  summary: 訂單已完成
                  value:
                    error: 訂單已付款
                expired:
                  summary: 訂單已過期
                  value:
                    error: 訂單已過期
  '/users/{userId}/orders':
    get:
      tags:
        - Users
      summary: 取得使用者的訂單清單
      description: |
        回傳特定使用者的訂單清單。

        **需要認證：**
        - 使用者必須已登入
        - 使用者只能查看自己的訂單（嘗試存取其他使用者的訂單會回傳 404）

        **使用案例：**
        - 在「訂單管理」區域顯示訂單清單
        - 讓使用者查看訂單歷史記錄

        **查詢參數：**
        - page：分頁的頁碼（選填，預設：1）
        - limit：每頁項目數（選填，預設：20）

        **回應：**
        - 所有訂單摘要清單（基本訂單資訊 + 第一個旅程項目）
        - 分頁中繼資料
        - 訂單按建立時間排序（最新的在前）
      operationId: getUserOrders
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: 使用者 ID
          schema:
            type: integer
            example: 11
        - name: page
          in: query
          required: false
          description: 頁碼（從 1 開始）
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          required: false
          description: 每頁項目數
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 20
      responses:
        '200':
          description: 成功取得訂單清單
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
              examples:
                success:
                  summary: 使用者訂單清單（含分頁）
                  value:
                    orders:
                      - id: 125
                        orderNumber: 20251122011117f3a
                        status: UNPAID
                        price: 5999
                        items:
                          - journeyId: 18
                            journeyTitle: Web 開發實戰
                        createdAt: 1732593600000
                      - id: 123
                        orderNumber: 20251121011117cd5
                        status: PAID
                        price: 7599
                        items:
                          - journeyId: 17
                            journeyTitle: AI x BDD：規格驅動全自動開發術
                        createdAt: 1732420800000
                        paidAt: 1732507200000
                    pagination:
                      page: 1
                      limit: 20
                      total: 2
        '401':
          description: 未授權 - 使用者未登入
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 使用者未認證
                  value:
                    error: 需要身份驗證
        '404':
          description: 找不到使用者或存取被拒絕
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 使用者不存在或存取被拒絕
                  value:
                    error: 找不到使用者
  '/users/{userId}/journeys':
    get:
      tags:
        - Users
      summary: 取得使用者已購買的旅程
      description: |
        回傳使用者已購買（可存取）的旅程清單。

        **需要認證：**
        - 使用者必須已登入
        - 使用者只能查看自己購買的旅程（嘗試存取其他使用者的旅程會回傳 404）

        **使用案例：**
        - 檢查使用者是否已購買特定旅程
        - 顯示使用者的課程庫
        - 在允許查看內容前驗證旅程存取權

        **回應：**
        - 已購買旅程清單及基本資訊
        - 購買時間戳記（付款完成時間）
        - 相關訂單編號供參考

        **注意：**
        - 僅包含已付款訂單的旅程（未付款訂單不授予存取權）
        - 前端可使用此清單來決定要顯示「繼續學習」或「立即加入課程」按鈕
      operationId: getUserJourneys
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: 使用者 ID
          schema:
            type: integer
            example: 11
      responses:
        '200':
          description: 成功取得使用者已購買的旅程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserJourneyListResponse'
              examples:
                success:
                  summary: 使用者已購買的旅程清單
                  value:
                    journeys:
                      - journeyId: 17
                        journeyTitle: AI x BDD：規格驅動全自動開發術
                        journeySlug: ai-bdd-spec-driven-development
                        coverImageUrl: 'https://example.com/covers/ai-bdd.jpg'
                        teacherName: 水球潘
                        purchasedAt: 1732507200000
                        orderNumber: 20251121011117cd5
                      - journeyId: 15
                        journeyTitle: 軟體設計模式精通之旅
                        journeySlug: software-design-patterns
                        coverImageUrl: 'https://example.com/covers/design-patterns.jpg'
                        teacherName: 水球潘
                        purchasedAt: 1732334400000
                        orderNumber: 20251119011115b2c
                empty:
                  summary: 使用者沒有已購買的旅程
                  value:
                    journeys: []
        '401':
          description: 未授權 - 使用者未登入
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  summary: 使用者未認證
                  value:
                    error: 需要身份驗證
        '404':
          description: 找不到使用者或存取被拒絕
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 使用者不存在或存取被拒絕
                  value:
                    error: 找不到使用者
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        從登入端點取得的 JWT 存取權杖。

        **使用方式：**
        包含在 Authorization 標頭中：`Authorization: Bearer <token>`

        **權杖內容：**
        - user_id：使用者識別碼
        - username：使用者名稱
        - iat：簽發時間戳記
        - exp：過期時間戳記（簽發後 1 天）

        **安全性：**
        - 權杖在 1 天後過期
        - 正式環境務必使用 HTTPS
  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - database
      properties:
        status:
          type: string
          enum:
            - UP
            - DOWN
          description: 服務的整體健康狀態
        database:
          type: string
          enum:
            - UP
            - DOWN
          description: 資料庫連線健康狀態
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: 錯誤訊息
          example: An error occurred
    RegisterRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 50
          pattern: '^[a-zA-Z0-9_]+$'
          description: 使用者名稱（僅限英數字和底線）
          example: john_doe123
        password:
          type: string
          minLength: 8
          maxLength: 72
          pattern: '^[a-zA-Z0-9@$!%*?&#]+$'
          description: 密碼（英數字和特殊字元，8-72 個字元）
          example: SecurePass123!
    RegisterResponse:
      type: object
      required:
        - message
        - userId
      properties:
        message:
          type: string
          description: 成功訊息
          example: Registration successful
        userId:
          type: integer
          description: 新建立的使用者 ID
          example: 1
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: 使用者名稱
          example: john_doe123
        password:
          type: string
          description: 密碼
          example: SecurePass123!
    LoginResponse:
      type: object
      required:
        - accessToken
        - user
      properties:
        accessToken:
          type: string
          description: JWT 存取權杖（1 天後過期）
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        user:
          $ref: '#/components/schemas/UserInfo'
    UserInfo:
      type: object
      required:
        - id
        - username
        - experience
      properties:
        id:
          type: integer
          description: 使用者 ID
          example: 1
        username:
          type: string
          description: 使用者名稱
          example: john_doe123
        experience:
          type: integer
          minimum: 0
          description: 使用者經驗值
          example: 0
    LogoutResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: 成功訊息
          example: Logout successful
    JourneyListItem:
      type: object
      required:
        - id
        - slug
        - title
        - description
        - coverImageUrl
        - teacherName
        - price
      properties:
        id:
          type: integer
          description: 旅程 ID
          example: 1
        slug:
          type: string
          description: 旅程的 URL 友善識別碼
          example: software-design-pattern
        title:
          type: string
          description: 旅程標題
          example: 軟體設計模式精通之旅
        description:
          type: string
          description: 旅程描述
          example: 用 C.A. 模式大大提昇系統思維能力
        coverImageUrl:
          type: string
          format: uri
          description: 封面圖片 URL
          example: 'https://example.com/cover1.jpg'
        teacherName:
          type: string
          description: 教師名稱
          example: 水球潘
        price:
          type: number
          format: decimal
          description: 旅程價格，單位為新台幣（TWD）
          example: 3990
    JourneyDetail:
      type: object
      required:
        - id
        - slug
        - title
        - description
        - coverImageUrl
        - teacherName
        - price
        - chapters
      properties:
        id:
          type: integer
          description: 旅程 ID
          example: 1
        slug:
          type: string
          description: 旅程的 URL 友善識別碼
          example: software-design-pattern
        title:
          type: string
          description: 旅程標題
          example: 軟體設計模式精通之旅
        description:
          type: string
          description: 旅程描述
          example: 用 C.A. 模式大大提昇系統思維能力
        coverImageUrl:
          type: string
          format: uri
          description: 封面圖片 URL
          example: 'https://example.com/cover1.jpg'
        teacherName:
          type: string
          description: 教師名稱
          example: 水球潘
        price:
          type: number
          format: decimal
          description: 旅程價格，單位為新台幣（TWD）
          example: 3990
        chapters:
          type: array
          description: 此旅程中的章節列表
          items:
            $ref: '#/components/schemas/Chapter'
    Chapter:
      type: object
      required:
        - id
        - title
        - orderIndex
        - missions
      properties:
        id:
          type: integer
          description: 章節 ID
          example: 1
        title:
          type: string
          description: 章節標題
          example: 課程介紹
        orderIndex:
          type: integer
          description: 章節排序索引
          example: 1
        missions:
          type: array
          description: 此章節中的任務列表
          items:
            $ref: '#/components/schemas/MissionSummary'
    MissionSummary:
      type: object
      required:
        - id
        - type
        - title
        - accessLevel
        - orderIndex
      properties:
        id:
          type: integer
          description: 任務 ID
          example: 1
        type:
          type: string
          enum:
            - VIDEO
            - ARTICLE
            - QUESTIONNAIRE
          description: 任務類型（影片、文章或問卷）
          example: VIDEO
        title:
          type: string
          description: 任務標題
          example: 這門課手把手帶你成為架構設計的高手
        accessLevel:
          type: string
          enum:
            - PUBLIC
            - AUTHENTICATED
            - PURCHASED
          description: |
            任務存取層級：
            - PUBLIC: 無需驗證即可檢視
            - AUTHENTICATED: 需要登入才能檢視
            - PURCHASED: 需要購買旅程才能檢視
          example: PUBLIC
        orderIndex:
          type: integer
          description: 任務在章節內的排序索引
          example: 1
        status:
          type: string
          enum:
            - UNCOMPLETED
            - COMPLETED
            - DELIVERED
          description: |
            已驗證使用者的任務完成狀態。
            - UNCOMPLETED: 任務進行中或尚未開始
            - COMPLETED: 任務已完成但尚未交付
            - DELIVERED: 任務已交付並已領取獎勵

            注意：此欄位僅在請求已驗證時包含。
            對於未驗證的請求，此欄位將為 null 或省略。
          example: UNCOMPLETED
          nullable: true
    MissionDetail:
      type: object
      required:
        - id
        - chapterId
        - journeyId
        - type
        - title
        - description
        - accessLevel
        - createdAt
        - reward
        - resource
      properties:
        id:
          type: integer
          description: 任務 ID
          example: 1
        chapterId:
          type: integer
          description: 此任務所屬的章節 ID
          example: 8
        journeyId:
          type: integer
          description: 旅程 ID（從章節衍生）
          example: 1
        type:
          type: string
          enum:
            - VIDEO
            - ARTICLE
            - QUESTIONNAIRE
          description: 任務類型
          example: VIDEO
        title:
          type: string
          description: 任務標題
          example: 課程介紹：這門課手把手帶你成為架構設計的高手
        description:
          type: string
          description: 任務的詳細描述
          example: 思維升級：Christopher Alexander 模式六大要素及模式語言
        accessLevel:
          type: string
          enum:
            - PUBLIC
            - AUTHENTICATED
            - PURCHASED
          description: |
            任務存取層級：
            - PUBLIC: 無需驗證即可檢視
            - AUTHENTICATED: 需要登入才能檢視
            - PURCHASED: 需要購買旅程才能檢視
          example: PUBLIC
        createdAt:
          type: integer
          format: int64
          description: 建立時間戳記（毫秒）
          example: 1733294001561
        videoLength:
          type: string
          description: '影片時長，格式為 MM:SS（僅限 VIDEO 類型，從內容衍生）'
          example: '04:16'
        reward:
          $ref: '#/components/schemas/MissionReward'
        resource:
          type: array
          description: 任務資源陣列（可包含多個項目）
          items:
            $ref: '#/components/schemas/MissionResource'
    MissionReward:
      type: object
      required:
        - exp
      properties:
        exp:
          type: integer
          description: 經驗值獎勵
          example: 100
    MissionResource:
      type: object
      required:
        - type
        - id
      properties:
        id:
          type: integer
          description: 資源項目 ID
          example: 0
        type:
          type: string
          enum:
            - video
            - article
            - form
          description: 資源類型（小寫）
          example: video
        resourceUrl:
          type: string
          format: uri
          description: 資源 URL（選填，影片/外部內容必填）
          example: 'https://cdn.waterballsa.tw/software-design-pattern/videos/c8m1-0/c8m1-0.m3u8'
        resourceContent:
          type: string
          description: 資源內容（選填，用於內嵌文字內容）
          example: Article content or form HTML here
        durationSeconds:
          type: integer
          description: 影片時長（秒）（僅限 VIDEO 類型）
          example: 256
    UpdateProgressRequest:
      type: object
      required:
        - watchPositionSeconds
      properties:
        watchPositionSeconds:
          type: integer
          description: 目前觀看位置（秒）（用於 VIDEO 任務）
          example: 150
          minimum: 0
    DeliverResponse:
      type: object
      required:
        - message
        - experienceGained
        - totalExperience
        - currentLevel
      properties:
        message:
          type: string
          description: 成功訊息
          example: Mission delivered successfully
        experienceGained:
          type: integer
          description: 此次交付獲得的經驗值
          example: 100
        totalExperience:
          type: integer
          description: 交付後使用者的總經驗值
          example: 1500
        currentLevel:
          type: integer
          description: 交付後使用者的目前等級
          example: 4
    UserMissionProgressResponse:
      type: object
      required:
        - missionId
        - status
        - watchPositionSeconds
      properties:
        missionId:
          type: integer
          description: 任務 ID
          example: 1
        status:
          type: string
          enum:
            - UNCOMPLETED
            - COMPLETED
            - DELIVERED
          description: 任務狀態
          example: COMPLETED
        watchPositionSeconds:
          type: integer
          description: 目前觀看位置（秒）（用於 VIDEO 任務）
          example: 256
    UserProfile:
      type: object
      required:
        - id
        - username
        - experiencePoints
        - level
        - role
      properties:
        id:
          type: integer
          description: 使用者 ID
          example: 1
        username:
          type: string
          description: 使用者名稱
          example: john_doe123
        experiencePoints:
          type: integer
          minimum: 0
          description: 累積的總經驗值
          example: 1500
        level:
          type: integer
          minimum: 1
          maximum: 36
          description: 目前等級（1-36）
          example: 4
        role:
          type: string
          enum:
            - STUDENT
            - TEACHER
            - ADMIN
          description: 使用者角色
          example: STUDENT
    CreateOrderRequest:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          description: 要購買的項目列表
          minItems: 1
          items:
            type: object
            required:
              - journeyId
              - quantity
            properties:
              journeyId:
                type: integer
                description: 要購買的旅程 ID
                example: 17
              quantity:
                type: integer
                description: 購買數量
                minimum: 1
                default: 1
                example: 1
    OrderResponse:
      type: object
      required:
        - id
        - orderNumber
        - userId
        - username
        - status
        - originalPrice
        - discount
        - price
        - items
        - createdAt
      properties:
        id:
          type: integer
          description: 訂單 ID
          example: 123
        orderNumber:
          type: string
          description: |
            唯一訂單編號，格式：{timestamp}{userId}{randomCode}
            範例：20251121011117cd5 = 2025112101（時間戳記）+ 11（使用者 ID）+ 17cd5（隨機碼）
          example: 20251121011117cd5
        userId:
          type: integer
          description: 建立此訂單的使用者 ID
          example: 11
        username:
          type: string
          description: 訂單擁有者的使用者名稱
          example: john_doe
        status:
          type: string
          enum:
            - UNPAID
            - PAID
            - EXPIRED
          description: |
            訂單狀態：
            - UNPAID: 訂單已建立但尚未付款
            - PAID: 付款完成，使用者擁有旅程存取權
            - EXPIRED: 訂單在 3 天後過期，無法付款
          example: UNPAID
        originalPrice:
          type: number
          format: decimal
          description: 總原價（所有項目原價的總和）
          example: 7599
        discount:
          type: number
          format: decimal
          description: 總折扣金額
          example: 0
        price:
          type: number
          format: decimal
          description: 最終應付金額（originalPrice - discount）
          example: 7599
        items:
          type: array
          description: 訂單項目列表（要購買的旅程）
          items:
            $ref: '#/components/schemas/OrderItem'
        createdAt:
          type: integer
          format: int64
          description: 訂單建立時間戳記（自紀元以來的毫秒數）
          example: 1732420800000
        expiredAt:
          type: integer
          format: int64
          description: 訂單過期時間戳記（created_at + 3 天，若已付款則為 null）
          example: 1732680000000
          nullable: true
        paidAt:
          type: integer
          format: int64
          description: 付款完成時間戳記（若尚未付款則為 null）
          example: 1732507200000
          nullable: true
    OrderItem:
      type: object
      required:
        - journeyId
        - journeyTitle
        - quantity
        - originalPrice
        - discount
        - price
      properties:
        journeyId:
          type: integer
          description: 旅程 ID
          example: 17
        journeyTitle:
          type: string
          description: 旅程標題（訂單建立時的快照）
          example: AI x BDD：規格驅動全自動開發術
        quantity:
          type: integer
          description: 此旅程的數量（MVP 中永遠為 1）
          example: 1
        originalPrice:
          type: number
          format: decimal
          description: 訂單建立時的旅程價格（鎖定價格）
          example: 7599
        discount:
          type: number
          format: decimal
          description: 套用至此項目的折扣
          example: 0
        price:
          type: number
          format: decimal
          description: 此項目的最終價格（originalPrice - discount）
          example: 7599
    PayOrderResponse:
      type: object
      required:
        - id
        - orderNumber
        - status
        - price
        - paidAt
        - message
      properties:
        id:
          type: integer
          description: 訂單 ID
          example: 123
        orderNumber:
          type: string
          description: 訂單編號
          example: 20251121011117cd5
        status:
          type: string
          enum:
            - PAID
          description: 訂單狀態（成功付款後永遠為 PAID）
          example: PAID
        price:
          type: number
          format: decimal
          description: 已付金額
          example: 7599
        paidAt:
          type: integer
          format: int64
          description: 付款完成時間戳記（自紀元以來的毫秒數）
          example: 1732507200000
        message:
          type: string
          description: 成功訊息
          example: 付款完成
    OrderListResponse:
      type: object
      required:
        - orders
        - pagination
      properties:
        orders:
          type: array
          description: 訂單摘要列表
          items:
            $ref: '#/components/schemas/OrderSummary'
        pagination:
          $ref: '#/components/schemas/Pagination'
    OrderSummary:
      type: object
      required:
        - id
        - orderNumber
        - status
        - price
        - items
        - createdAt
      properties:
        id:
          type: integer
          description: 訂單 ID
          example: 123
        orderNumber:
          type: string
          description: 訂單編號
          example: 20251121011117cd5
        status:
          type: string
          enum:
            - UNPAID
            - PAID
            - EXPIRED
          description: 訂單狀態
          example: UNPAID
        price:
          type: number
          format: decimal
          description: 最終應付金額
          example: 7599
        items:
          type: array
          description: 簡化的訂單項目（用於列表顯示）
          items:
            $ref: '#/components/schemas/OrderItemSummary'
        createdAt:
          type: integer
          format: int64
          description: 訂單建立時間戳記
          example: 1732420800000
        expiredAt:
          type: integer
          format: int64
          description: 訂單過期時間戳記（created_at + 3 天，若已付款則為 null）
          example: 1732680000000
          nullable: true
        paidAt:
          type: integer
          format: int64
          description: 付款完成時間戳記（若未付款則為 null）
          example: 1732507200000
          nullable: true
    OrderItemSummary:
      type: object
      required:
        - journeyId
        - journeyTitle
      properties:
        journeyId:
          type: integer
          description: 旅程 ID
          example: 17
        journeyTitle:
          type: string
          description: 旅程標題
          example: AI x BDD：規格驅動全自動開發術
    Pagination:
      type: object
      required:
        - page
        - limit
        - total
      properties:
        page:
          type: integer
          description: 目前頁碼（從 1 開始）
          example: 1
        limit:
          type: integer
          description: 每頁項目數量
          example: 20
        total:
          type: integer
          description: 項目總數
          example: 5
    UserJourneyListResponse:
      type: object
      required:
        - journeys
      properties:
        journeys:
          type: array
          description: 使用者已購買的旅程列表
          items:
            $ref: '#/components/schemas/UserJourneyItem'
    UserJourneyItem:
      type: object
      required:
        - journeyId
        - journeyTitle
        - journeySlug
        - coverImageUrl
        - teacherName
        - purchasedAt
        - orderNumber
      properties:
        journeyId:
          type: integer
          description: 旅程 ID
          example: 17
        journeyTitle:
          type: string
          description: 旅程標題
          example: AI x BDD：規格驅動全自動開發術
        journeySlug:
          type: string
          description: 旅程的 URL 友善識別碼
          example: ai-bdd-spec-driven-development
        coverImageUrl:
          type: string
          format: uri
          description: 旅程封面圖片 URL
          example: 'https://example.com/covers/ai-bdd.jpg'
        teacherName:
          type: string
          description: 教師名稱
          example: 水球潘
        purchasedAt:
          type: integer
          format: int64
          description: 購買時間戳記 - 訂單付款完成時間（自紀元以來的毫秒數）
          example: 1732507200000
        orderNumber:
          type: string
          description: 授予此旅程存取權的訂單編號
          example: 20251121011117cd5
