openapi: 3.0.3
info:
  title: WaterBall SA 後端 API
  description: |
    WaterBall SA 平台後端 API

    此 API 提供 WaterBall SA 學習平台的端點，包括健康檢查、
    旅程管理和使用者互動。
  version: 1.0.0
  contact:
    name: API 支援
    email: support@waterballsa.tw

servers:
  - url: http://localhost:8080
    description: 開發伺服器
  - url: https://api.waterballsa.tw
    description: 正式環境伺服器

tags:
  - name: Health Check
    description: API 健康監控端點
  - name: Auth
    description: 使用者認證與授權端點
  - name: Journeys
    description: 學習旅程管理端點
  - name: Missions
    description: 學習任務（影片/文章/問卷）管理端點
  - name: Progress
    description: 使用者任務進度追蹤端點
  - name: Users
    description: 使用者個人資料與資訊端點
  - name: Orders
    description: 課程購買訂單管理端點
  - name: User Journeys
    description: 使用者已購買旅程存取管理端點

paths:
  /healthz:
    $ref: './openapi/paths/health.yaml'

  /auth/register:
    $ref: './openapi/paths/auth.yaml#/register'

  /auth/login:
    $ref: './openapi/paths/auth.yaml#/login'

  /auth/logout:
    $ref: './openapi/paths/auth.yaml#/logout'

  /journeys:
    $ref: './openapi/paths/journeys.yaml#/list'

  /journeys/{journeyId}:
    $ref: './openapi/paths/journeys.yaml#/detail'

  /journeys/{journeyId}/missions/{missionId}:
    $ref: './openapi/paths/missions.yaml#/detail'

  /users/{userId}/missions/{missionId}/progress:
    $ref: './openapi/paths/progress.yaml#/detail'

  /users/{userId}/missions/{missionId}/progress/deliver:
    $ref: './openapi/paths/progress.yaml#/deliver'

  /users/me:
    $ref: './openapi/paths/users.yaml#/me'

  /orders:
    $ref: './openapi/paths/orders.yaml#/create'

  /orders/{orderId}:
    $ref: './openapi/paths/orders.yaml#/detail'

  /orders/{orderId}/action/pay:
    $ref: './openapi/paths/orders.yaml#/pay'

  /users/{userId}/orders:
    $ref: './openapi/paths/users.yaml#/orders'

  /users/{userId}/journeys:
    $ref: './openapi/paths/users.yaml#/journeys'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        從登入端點取得的 JWT 存取權杖。

        **使用方式：**
        包含在 Authorization 標頭中：`Authorization: Bearer <token>`

        **權杖內容：**
        - user_id：使用者識別碼
        - username：使用者名稱
        - iat：簽發時間戳記
        - exp：過期時間戳記（簽發後 1 天）

        **安全性：**
        - 權杖在 1 天後過期
        - 正式環境務必使用 HTTPS

  schemas:
    # Common schemas
    HealthResponse:
      $ref: './openapi/schemas/common.yaml#/HealthResponse'
    ErrorResponse:
      $ref: './openapi/schemas/common.yaml#/ErrorResponse'

    # Auth schemas
    RegisterRequest:
      $ref: './openapi/schemas/auth.yaml#/RegisterRequest'
    RegisterResponse:
      $ref: './openapi/schemas/auth.yaml#/RegisterResponse'
    LoginRequest:
      $ref: './openapi/schemas/auth.yaml#/LoginRequest'
    LoginResponse:
      $ref: './openapi/schemas/auth.yaml#/LoginResponse'
    UserInfo:
      $ref: './openapi/schemas/auth.yaml#/UserInfo'
    LogoutResponse:
      $ref: './openapi/schemas/auth.yaml#/LogoutResponse'

    # Journey schemas
    JourneyListItem:
      $ref: './openapi/schemas/journeys.yaml#/JourneyListItem'
    JourneyDetail:
      $ref: './openapi/schemas/journeys.yaml#/JourneyDetail'
    Chapter:
      $ref: './openapi/schemas/journeys.yaml#/Chapter'
    MissionSummary:
      $ref: './openapi/schemas/journeys.yaml#/MissionSummary'

    # Mission schemas
    MissionDetail:
      $ref: './openapi/schemas/missions.yaml#/MissionDetail'
    MissionReward:
      $ref: './openapi/schemas/missions.yaml#/MissionReward'
    MissionResource:
      $ref: './openapi/schemas/missions.yaml#/MissionResource'
    UpdateProgressRequest:
      $ref: './openapi/schemas/missions.yaml#/UpdateProgressRequest'
    ProgressUpdateResponse:
      $ref: './openapi/schemas/missions.yaml#/ProgressUpdateResponse'
    DeliverResponse:
      $ref: './openapi/schemas/missions.yaml#/DeliverResponse'
    UserMissionProgress:
      $ref: './openapi/schemas/missions.yaml#/UserMissionProgress'

    # User schemas
    UserProfile:
      $ref: './openapi/schemas/users.yaml#/UserProfile'

    # Order schemas
    CreateOrderRequest:
      $ref: './openapi/schemas/orders.yaml#/CreateOrderRequest'
    OrderResponse:
      $ref: './openapi/schemas/orders.yaml#/OrderResponse'
    OrderItem:
      $ref: './openapi/schemas/orders.yaml#/OrderItem'
    PayOrderResponse:
      $ref: './openapi/schemas/orders.yaml#/PayOrderResponse'
    OrderListResponse:
      $ref: './openapi/schemas/orders.yaml#/OrderListResponse'
    OrderSummary:
      $ref: './openapi/schemas/orders.yaml#/OrderSummary'
    OrderItemSummary:
      $ref: './openapi/schemas/orders.yaml#/OrderItemSummary'
    Pagination:
      $ref: './openapi/schemas/orders.yaml#/Pagination'

    # User Journey schemas
    UserJourneyListResponse:
      $ref: './openapi/schemas/users.yaml#/UserJourneyListResponse'
    UserJourneyItem:
      $ref: './openapi/schemas/users.yaml#/UserJourneyItem'

    # Journey purchase status schema
    UserStatus:
      $ref: './openapi/schemas/journeys.yaml#/UserStatus'
