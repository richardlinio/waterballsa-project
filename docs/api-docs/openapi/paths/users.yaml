me:
  get:
    tags:
      - Users
    summary: 取得目前使用者的個人資料
    description: |
      回傳目前已認證使用者的個人資料資訊。

      **認證：**
      - 需要有效的 JWT token

      **回應包含：**
      - 使用者 ID
      - 使用者名稱
      - 經驗值（累計總數）
      - 目前等級（從經驗值計算）
      - 使用者角色（STUDENT、TEACHER、ADMIN）

      **等級資訊：**
      - 等級根據總經驗值計算
      - 最高等級為 36（需要 65000+ XP）
    operationId: getCurrentUser
    security:
      - bearerAuth: []
    responses:
      '200':
        description: 成功取得使用者個人資料
        content:
          application/json:
            schema:
              $ref: '../schemas/users.yaml#/UserProfile'
            examples:
              student:
                summary: 學生使用者個人資料
                value:
                  id: 1
                  username: 'john_doe123'
                  experiencePoints: 1500
                  level: 4
                  role: 'STUDENT'
              highLevel:
                summary: 高等級學生
                value:
                  id: 2
                  username: 'advanced_learner'
                  experiencePoints: 15000
                  level: 11
                  role: 'STUDENT'
      '401':
        description: 未授權 - 無效或遺失的 token
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
            examples:
              unauthorized:
                summary: 無效或遺失的 token
                value:
                  error: '未授權或無效的 token'
      '404':
        description: 找不到 - 找不到使用者個人資料
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
            examples:
              notFound:
                summary: 找不到使用者
                value:
                  error: '找不到使用者'

journeys:
  get:
    tags:
      - Users
    summary: 取得使用者已購買的旅程
    description: |
      回傳使用者已購買（可存取）的旅程清單。

      **需要認證：**
      - 使用者必須已登入
      - 使用者只能查看自己購買的旅程（嘗試存取其他使用者的旅程會回傳 404）

      **使用案例：**
      - 檢查使用者是否已購買特定旅程
      - 顯示使用者的課程庫
      - 在允許查看內容前驗證旅程存取權

      **回應：**
      - 已購買旅程清單及基本資訊
      - 購買時間戳記（付款完成時間）
      - 相關訂單編號供參考

      **注意：**
      - 僅包含已付款訂單的旅程（未付款訂單不授予存取權）
      - 前端可使用此清單來決定要顯示「繼續學習」或「立即加入課程」按鈕
    operationId: getUserJourneys
    security:
      - bearerAuth: []
    parameters:
      - name: userId
        in: path
        required: true
        description: 使用者 ID
        schema:
          type: integer
          example: 11
    responses:
      '200':
        description: 成功取得使用者已購買的旅程
        content:
          application/json:
            schema:
              $ref: '../schemas/users.yaml#/UserJourneyListResponse'
            examples:
              success:
                summary: 使用者已購買的旅程清單
                value:
                  journeys:
                    - journeyId: 17
                      journeyTitle: 'AI x BDD：規格驅動全自動開發術'
                      journeySlug: 'ai-bdd-spec-driven-development'
                      coverImageUrl: 'https://example.com/covers/ai-bdd.jpg'
                      teacherName: '水球潘'
                      purchasedAt: 1732507200000
                      orderNumber: '20251121011117cd5'
                    - journeyId: 15
                      journeyTitle: '軟體設計模式精通之旅'
                      journeySlug: 'software-design-patterns'
                      coverImageUrl: 'https://example.com/covers/design-patterns.jpg'
                      teacherName: '水球潘'
                      purchasedAt: 1732334400000
                      orderNumber: '20251119011115b2c'
              empty:
                summary: 使用者沒有已購買的旅程
                value:
                  journeys: []
      '401':
        description: 未授權 - 使用者未登入
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
            examples:
              unauthorized:
                summary: 使用者未認證
                value:
                  error: '需要身份驗證'
      '404':
        description: 找不到使用者或存取被拒絕
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
            examples:
              notFound:
                summary: 使用者不存在或存取被拒絕
                value:
                  error: '找不到使用者'

orders:
  get:
    tags:
      - Users
    summary: 取得使用者的訂單清單
    description: |
      回傳特定使用者的訂單清單。

      **需要認證：**
      - 使用者必須已登入
      - 使用者只能查看自己的訂單（嘗試存取其他使用者的訂單會回傳 404）

      **使用案例：**
      - 在「訂單管理」區域顯示訂單清單
      - 讓使用者查看訂單歷史記錄

      **查詢參數：**
      - page：分頁的頁碼（選填，預設：1）
      - limit：每頁項目數（選填，預設：20）

      **回應：**
      - 所有訂單摘要清單（基本訂單資訊 + 第一個旅程項目）
      - 分頁中繼資料
      - 訂單按建立時間排序（最新的在前）
    operationId: getUserOrders
    security:
      - bearerAuth: []
    parameters:
      - name: userId
        in: path
        required: true
        description: 使用者 ID
        schema:
          type: integer
          example: 11
      - name: page
        in: query
        required: false
        description: 頁碼（從 1 開始）
        schema:
          type: integer
          minimum: 1
          default: 1
          example: 1
      - name: limit
        in: query
        required: false
        description: 每頁項目數
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          example: 20
    responses:
      '200':
        description: 成功取得訂單清單
        content:
          application/json:
            schema:
              $ref: '../schemas/orders.yaml#/OrderListResponse'
            examples:
              success:
                summary: 使用者訂單清單（含分頁）
                value:
                  orders:
                    - id: 125
                      orderNumber: '20251122011117f3a'
                      status: 'UNPAID'
                      price: 5999.00
                      items:
                        - journeyId: 18
                          journeyTitle: 'Web 開發實戰'
                      createdAt: 1732593600000
                    - id: 123
                      orderNumber: '20251121011117cd5'
                      status: 'PAID'
                      price: 7599.00
                      items:
                        - journeyId: 17
                          journeyTitle: 'AI x BDD：規格驅動全自動開發術'
                      createdAt: 1732420800000
                      paidAt: 1732507200000
                  pagination:
                    page: 1
                    limit: 20
                    total: 2
      '401':
        description: 未授權 - 使用者未登入
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
            examples:
              unauthorized:
                summary: 使用者未認證
                value:
                  error: '需要身份驗證'
      '404':
        description: 找不到使用者或存取被拒絕
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
            examples:
              notFound:
                summary: 使用者不存在或存取被拒絕
                value:
                  error: '找不到使用者'
